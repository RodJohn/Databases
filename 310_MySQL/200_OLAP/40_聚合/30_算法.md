# 概述

定义

    
    
    MySQL采用流聚合
    
    

排序

    流聚合会先对聚合列进行排序
    
    mysql>  select * from orders;
    +----+-------------+---------------------+
    | id | customer_id | orderdate           |
    +----+-------------+---------------------+
    |  1 |           1 | 2018-04-01 10:00:00 |
    |  2 |           1 | 2018-04-01 10:01:00 |
    |  3 |           1 | 2018-04-02 10:00:00 |
    |  4 |           1 | 2018-05-01 10:00:00 |
    |  5 |           2 | 2018-04-01 10:02:00 |
    |  6 |           2 | 2018-05-01 10:00:00 |
    |  7 |           3 | 2018-04-01 10:05:00 |
    +----+-------------+---------------------+

    mysql> explain extended select customer_id ,max(orderdate) from orders group by customer_id;
    +----+-------------+--------+------+---------------+------+---------+------+------+----------+---------------------------------+
    | id | select_type | table  | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                           |
    +----+-------------+--------+------+---------------+------+---------+------+------+----------+---------------------------------+
    |  1 | SIMPLE      | orders | ALL  | NULL          | NULL | NULL    | NULL |    7 |   100.00 | Using temporary; Using filesort |
    +----+-------------+--------+------+---------------+------+---------+------+------+----------+---------------------------------+
    1 row in set, 1 warning (0.01 sec)
    
    
    mysql>  select customer_id ,max(orderdate) from orders group by customer_id;
    +-------------+---------------------+
    | customer_id | max(orderdate)      |
    +-------------+---------------------+
    |           1 | 2018-05-01 10:00:00 |
    |           2 | 2018-05-01 10:00:00 |
    |           3 | 2018-04-01 10:05:00 |
    +-------------+---------------------+
    3 rows in set (0.00 sec)


流操作

    流聚合会考虑每一个输入行
    如果输入行不属于当前分组,添加新的分组,设置值
    如果输入行属于当前分组,则根据聚合函数比较新旧值进行更新
    








    