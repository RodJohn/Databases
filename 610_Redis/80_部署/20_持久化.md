
# 数据库

概述

    有16个数据库,编号为0-15

操作

    select 
    
持久化和性能    
    
# 


redis理解为缓存技术，也可以理解为数据库，
因为redis支持将内存中的数据周期性的写入磁盘或者把操作追加到记录文件中，这个过程称为redis的持久化。
redis支持两种方式的持久化，一种是快照方式（snapshotting）,也称RDB方式；
两一种是追加文件方式（append-only file），也称AOF方式。RDB方式是redis默认的持久化方式。    

# RDB

RDB方式

    RDB方式是将内存中的数据的快照以二进制的方式写入名字为 dump.rdb的文件中。
    我们对 Redis 进行设置， 让它根据设置周期性自动保存数据集

dump.rdb

save
    使用主进程进行备份,阻塞客户端
bgsave
    客户端执行bgsave
    服务器端 save second actions
    原理
    使用一个新的进程执行备份,不阻塞主进程
    主进程处理客户端请求,父子进程通过fork的copy on write 进行同步
    周期性的执行
    
    缺点
        周期长  
    



# AOF

保存被执行的命令

主进程主线程事件

    
AOF方式

    RDB方式是周期性的持久化数据， 
    如果未到持久化时间点，Redis 因为某些原因而造成故障停机， 那么服务器将丢失最近写入、且仍未保存到快照中的那些数据。
    AOF 持久化记录服务器执行的所有写操作命令，并在服务器启动时，通过重新执行这些命令来还原数据集。 
    AOF 文件中的命令全部以 Redis 协议的格式来保存，新命令会被追加到文件的末尾。
    AOF方式仍然有丢失数据的可能，因为收到写命令后可能并不会马上将写命令写入磁盘，
    因此我们可以修改redis.conf，配置redis调用write函数写入命令到文件中的时机。如下
    
    #启用AOF方式
    appendonly yes
    #每次有新命令追加到 AOF 文件时就执行一次 fsync ：非常慢，也非常安全
    appendfsync always
    #每秒 fsync 一次：足够快（和使用 RDB 持久化差不多），并且在故障时只会丢失 1 秒钟的数据
    appendfsync everysec
    #从不 fsync ：将数据交给操作系统来处理。更快，也更不安全的选择
    appendfsync no
    
    
    重写原理    